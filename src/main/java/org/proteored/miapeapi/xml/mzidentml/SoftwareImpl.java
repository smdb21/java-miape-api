package org.proteored.miapeapi.xml.mzidentml;

import java.util.List;

import org.proteored.miapeapi.cv.Accession;
import org.proteored.miapeapi.cv.ControlVocabularyManager;
import org.proteored.miapeapi.cv.ControlVocabularyTerm;
import org.proteored.miapeapi.cv.ms.SoftwareName;
import org.proteored.miapeapi.interfaces.Software;
import org.proteored.miapeapi.xml.mzidentml.autogenerated.FuGECommonAuditContactType;
import org.proteored.miapeapi.xml.mzidentml.autogenerated.FuGECommonOntologyCvParamType;
import org.proteored.miapeapi.xml.mzidentml.autogenerated.FuGECommonOntologyUserParamType;
import org.proteored.miapeapi.xml.mzidentml.autogenerated.PSIPIAnalysisSearchAnalysisSoftwareType;

public class SoftwareImpl implements Software {
	private final PSIPIAnalysisSearchAnalysisSoftwareType xmlSoftware;
	private final List<FuGECommonAuditContactType> listContacts;
	private final Integer identifier;
	private final ControlVocabularyManager cvManager;

	public SoftwareImpl(PSIPIAnalysisSearchAnalysisSoftwareType xmlSoftware,
			List<FuGECommonAuditContactType> listContacts, Integer identifier,
			ControlVocabularyManager cvManager) {
		this.xmlSoftware = xmlSoftware;
		this.listContacts = listContacts;
		this.identifier = identifier;
		this.cvManager = cvManager;
	}

	@Override
	public String getCatalogNumber() {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public String getComments() {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public String getCustomizations() {
		return xmlSoftware.getCustomizations();
	}

	@Override
	public String getDescription() {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public String getManufacturer() {
		FuGECommonAuditContactType manufacturer = null;
		if (xmlSoftware.getContactRole() != null) {
			String id = xmlSoftware.getContactRole().getContactRef();

			for (FuGECommonAuditContactType contact : listContacts) {
				if (contact.getId().equals(id)) {
					manufacturer = contact;
				}
			}
		}

		if (manufacturer != null) {
			return manufacturer.getName();
		}
		return null;
	}

	@Override
	public String getModel() {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public String getName() {
		if (xmlSoftware.getSoftwareName() != null) {
			FuGECommonOntologyCvParamType cvParam = xmlSoftware
					.getSoftwareName().getCvParam();
			if (cvParam != null) {
				final ControlVocabularyTerm cvTermByAccession = SoftwareName
						.getInstance(cvManager).getCVTermByAccession(
								new Accession(cvParam.getAccession()));
				if (cvTermByAccession != null)

					return cvParam.getName();

			}
			FuGECommonOntologyUserParamType userParam = xmlSoftware
					.getSoftwareName().getUserParam();
			if (userParam != null) {
				return userParam.getName();
			}
		}
		return xmlSoftware.getName();
	}

	@Override
	public String getParameters() {
		return null;
	}

	@Override
	public String getURI() {
		return xmlSoftware.getURI();
	}

	@Override
	public String getVersion() {
		return xmlSoftware.getVersion();
	}

	@Override
	public String toString() {
		return "SoftwareImpl [getCatalogNumber()=" + getCatalogNumber()
				+ ", getComments()=" + getComments() + ", getCustomizations()="
				+ getCustomizations() + ", getDescription()="
				+ getDescription() + ", getManufacturer()=" + getManufacturer()
				+ ", getModel()=" + getModel() + ", getName()=" + getName()
				+ ", getParameters()=" + getParameters() + ", getUri()="
				+ getURI() + ", getVersion()=" + getVersion() + "]";
	}

	@Override
	public int getId() {
		if (identifier != null)
			return identifier;
		return -1;
	}

}
